/////////////////////////////////////////////////////////////////////////////
///////////////////////////// EULERIAN TOOLS ////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

/*
 * These functions are all related to the Eulerian elevation change.
 */




/////////////////////////////////////////////////////////////////////////////
//////////////////// ADD TIMEBAND TO IMAGECOLLECTION ////////////////////////
/////////////////////////////////////////////////////////////////////////////


var addTimeBand = function(image) {
  return image.addBands(image.metadata('system:time_start')
    .divide(1000 * 60 * 60 * 24 * 365).subtract(40));
};

exports.addTimeBand = addTimeBand;




/////////////////////////////////////////////////////////////////////////////
/////////////////////// FILTER BY MEDIAN ELEVATION //////////////////////////
/////////////////////////////////////////////////////////////////////////////

// This function filters out points that differs more than "maxElevDiff" from the median REMA elevations

var filterByMedianREMA = function(medianREMA,maxElevDiff){
  return(
    function(image){
    var REMAmed = medianREMA.updateMask(image.mask());
    var diff = REMAmed.subtract(image).abs().rename('diff');
    image = image.updateMask(diff.select('diff').lte(maxElevDiff));
    return image;
})};

exports.filterByMedianREMA = filterByMedianREMA;





/////////////////////////////////////////////////////////////////////////////
//////////////////////////// THINNING OUTLIERS //////////////////////////////
/////////////////////////////////////////////////////////////////////////////


var outlierMask = function(image,maxdhdt){
    return image.updateMask(image.lte(maxdhdt).and(image.gte(-maxdhdt)))};

exports.outlierMask = outlierMask;
